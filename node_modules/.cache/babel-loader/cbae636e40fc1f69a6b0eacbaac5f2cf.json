{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.PreviewManager = void 0;\n\nvar _objectAssign = _interopRequireDefault(require(\"./objectAssign\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar PreviewList = function PreviewList() {\n  var _this = this;\n\n  _classCallCheck(this, PreviewList);\n\n  this.register = function (preview) {\n    _this.previews.push(preview);\n  };\n\n  this.unregister = function (preview) {\n    var index;\n\n    while ((index = _this.previews.indexOf(preview)) !== -1) {\n      _this.previews.splice(index, 1);\n    }\n  };\n\n  this.backendChanged = function (backend) {\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = _this.previews[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var preview = _step.value;\n        preview.backendChanged(backend);\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  };\n\n  this.previews = [];\n};\n\nvar PreviewManager = new PreviewList();\nexports.PreviewManager = PreviewManager;\n\nvar _default = function _default(manager, context, sourceOptions) {\n  var _this2 = this;\n\n  _classCallCheck(this, _default);\n\n  this.setup = function () {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    if (_this2.constructor.isSetUp) {\n      throw new Error('Cannot have two MultiBackends at the same time.');\n    }\n\n    _this2.constructor.isSetUp = true;\n\n    _this2.addEventListeners(window);\n\n    _this2.backends[_this2.current].instance.setup();\n  };\n\n  this.teardown = function () {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    _this2.constructor.isSetUp = false;\n\n    _this2.removeEventListeners(window);\n\n    _this2.backends[_this2.current].instance.teardown();\n  };\n\n  this.connectDragSource = function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _this2.connectBackend('connectDragSource', args);\n  };\n\n  this.connectDragPreview = function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return _this2.connectBackend('connectDragPreview', args);\n  };\n\n  this.connectDropTarget = function () {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return _this2.connectBackend('connectDropTarget', args);\n  };\n\n  this.previewEnabled = function () {\n    return _this2.backends[_this2.current].preview;\n  };\n\n  this.addEventListeners = function (target) {\n    _this2.backends.forEach(function (backend) {\n      if (backend.transition) {\n        target.addEventListener(backend.transition.event, _this2.backendSwitcher, true);\n      }\n    });\n  };\n\n  this.removeEventListeners = function (target) {\n    _this2.backends.forEach(function (backend) {\n      if (backend.transition) {\n        target.removeEventListener(backend.transition.event, _this2.backendSwitcher, true);\n      }\n    });\n  };\n\n  this.backendSwitcher = function (event) {\n    var oldBackend = _this2.current;\n    var i = 0;\n\n    _this2.backends.some(function (backend) {\n      if (i !== _this2.current && backend.transition && backend.transition.check(event)) {\n        _this2.current = i;\n        return true;\n      }\n\n      i += 1;\n      return false;\n    });\n\n    if (_this2.current !== oldBackend) {\n      _this2.backends[oldBackend].instance.teardown();\n\n      Object.keys(_this2.nodes).forEach(function (id) {\n        var node = _this2.nodes[id];\n        node.handler();\n        node.handler = _this2.callBackend(node.func, node.args);\n      });\n      PreviewManager.backendChanged(_this2);\n      var newBackend = _this2.backends[_this2.current];\n      newBackend.instance.setup();\n\n      if (newBackend.skipDispatchOnTransition) {\n        return;\n      }\n\n      var newEvent = null;\n\n      try {\n        newEvent = new event.constructor(event.type, event);\n      } catch (_e) {\n        newEvent = document.createEvent('Event');\n        newEvent.initEvent(event.type, event.bubbles, event.cancelable);\n      }\n\n      event.target.dispatchEvent(newEvent);\n    }\n  };\n\n  this.callBackend = function (func, args) {\n    var _this2$backends$_this;\n\n    return (_this2$backends$_this = _this2.backends[_this2.current].instance)[func].apply(_this2$backends$_this, _toConsumableArray(args));\n  };\n\n  this.connectBackend = function (func, args) {\n    var nodeId = \"\".concat(func, \"_\").concat(args[0]);\n\n    var handler = _this2.callBackend(func, args);\n\n    _this2.nodes[nodeId] = {\n      func: func,\n      args: args,\n      handler: handler\n    };\n    return function () {\n      var _this2$nodes$nodeId;\n\n      var r = (_this2$nodes$nodeId = _this2.nodes[nodeId]).handler.apply(_this2$nodes$nodeId, arguments);\n\n      delete _this2.nodes[nodeId];\n      return r;\n    };\n  };\n\n  var options = (0, _objectAssign.default)({\n    backends: []\n  }, sourceOptions || {});\n\n  if (options.backends.length < 1) {\n    throw new Error(\"You must specify at least one Backend, if you are coming from 2.x.x (or don't understand this error)\\n        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-2xx\");\n  }\n\n  this.current = 0;\n  this.backends = [];\n  options.backends.forEach(function (backend) {\n    if (!backend.backend) {\n      throw new Error(\"You must specify a 'backend' property in your Backend entry: \".concat(backend));\n    }\n\n    var transition = backend.transition;\n\n    if (transition && !transition._isMBTransition) {\n      throw new Error(\"You must specify a valid 'transition' property (either undefined or the return of 'createTransition') in your Backend entry: \".concat(backend));\n    }\n\n    _this2.backends.push({\n      instance: new backend.backend(manager, context, backend.options),\n      preview: backend.preview || false,\n      transition: transition,\n      skipDispatchOnTransition: Boolean(backend.skipDispatchOnTransition)\n    });\n  });\n  this.nodes = {};\n} // DnD Backend API\n;\n\nexports.default = _default;","map":{"version":3,"sources":["/home/janne/repot/OperaatioJyrki/node_modules/dnd-multi-backend/lib/MultiBackend.js"],"names":["Object","defineProperty","exports","value","default","PreviewManager","_objectAssign","_interopRequireDefault","require","obj","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","prototype","toString","call","Array","from","isArray","i","arr2","length","_classCallCheck","instance","Constructor","PreviewList","_this","register","preview","previews","push","unregister","index","indexOf","splice","backendChanged","backend","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","_step","next","done","err","return","_default","manager","context","sourceOptions","_this2","setup","window","constructor","isSetUp","Error","addEventListeners","backends","current","teardown","removeEventListeners","connectDragSource","_len","arguments","args","_key","connectBackend","connectDragPreview","_len2","_key2","connectDropTarget","_len3","_key3","previewEnabled","target","forEach","transition","addEventListener","event","backendSwitcher","removeEventListener","oldBackend","some","check","keys","nodes","id","node","handler","callBackend","func","newBackend","skipDispatchOnTransition","newEvent","type","_e","document","createEvent","initEvent","bubbles","cancelable","dispatchEvent","_this2$backends$_this","apply","nodeId","concat","_this2$nodes$nodeId","r","options","_isMBTransition","Boolean"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.PreviewManager = void 0;\n\nvar _objectAssign = _interopRequireDefault(require(\"./objectAssign\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PreviewList = function PreviewList() {\n  var _this = this;\n\n  _classCallCheck(this, PreviewList);\n\n  this.register = function (preview) {\n    _this.previews.push(preview);\n  };\n\n  this.unregister = function (preview) {\n    var index;\n\n    while ((index = _this.previews.indexOf(preview)) !== -1) {\n      _this.previews.splice(index, 1);\n    }\n  };\n\n  this.backendChanged = function (backend) {\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = _this.previews[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var preview = _step.value;\n        preview.backendChanged(backend);\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  };\n\n  this.previews = [];\n};\n\nvar PreviewManager = new PreviewList();\nexports.PreviewManager = PreviewManager;\n\nvar _default = function _default(manager, context, sourceOptions) {\n  var _this2 = this;\n\n  _classCallCheck(this, _default);\n\n  this.setup = function () {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    if (_this2.constructor.isSetUp) {\n      throw new Error('Cannot have two MultiBackends at the same time.');\n    }\n\n    _this2.constructor.isSetUp = true;\n\n    _this2.addEventListeners(window);\n\n    _this2.backends[_this2.current].instance.setup();\n  };\n\n  this.teardown = function () {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    _this2.constructor.isSetUp = false;\n\n    _this2.removeEventListeners(window);\n\n    _this2.backends[_this2.current].instance.teardown();\n  };\n\n  this.connectDragSource = function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _this2.connectBackend('connectDragSource', args);\n  };\n\n  this.connectDragPreview = function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return _this2.connectBackend('connectDragPreview', args);\n  };\n\n  this.connectDropTarget = function () {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return _this2.connectBackend('connectDropTarget', args);\n  };\n\n  this.previewEnabled = function () {\n    return _this2.backends[_this2.current].preview;\n  };\n\n  this.addEventListeners = function (target) {\n    _this2.backends.forEach(function (backend) {\n      if (backend.transition) {\n        target.addEventListener(backend.transition.event, _this2.backendSwitcher, true);\n      }\n    });\n  };\n\n  this.removeEventListeners = function (target) {\n    _this2.backends.forEach(function (backend) {\n      if (backend.transition) {\n        target.removeEventListener(backend.transition.event, _this2.backendSwitcher, true);\n      }\n    });\n  };\n\n  this.backendSwitcher = function (event) {\n    var oldBackend = _this2.current;\n    var i = 0;\n\n    _this2.backends.some(function (backend) {\n      if (i !== _this2.current && backend.transition && backend.transition.check(event)) {\n        _this2.current = i;\n        return true;\n      }\n\n      i += 1;\n      return false;\n    });\n\n    if (_this2.current !== oldBackend) {\n      _this2.backends[oldBackend].instance.teardown();\n\n      Object.keys(_this2.nodes).forEach(function (id) {\n        var node = _this2.nodes[id];\n        node.handler();\n        node.handler = _this2.callBackend(node.func, node.args);\n      });\n      PreviewManager.backendChanged(_this2);\n      var newBackend = _this2.backends[_this2.current];\n      newBackend.instance.setup();\n\n      if (newBackend.skipDispatchOnTransition) {\n        return;\n      }\n\n      var newEvent = null;\n\n      try {\n        newEvent = new event.constructor(event.type, event);\n      } catch (_e) {\n        newEvent = document.createEvent('Event');\n        newEvent.initEvent(event.type, event.bubbles, event.cancelable);\n      }\n\n      event.target.dispatchEvent(newEvent);\n    }\n  };\n\n  this.callBackend = function (func, args) {\n    var _this2$backends$_this;\n\n    return (_this2$backends$_this = _this2.backends[_this2.current].instance)[func].apply(_this2$backends$_this, _toConsumableArray(args));\n  };\n\n  this.connectBackend = function (func, args) {\n    var nodeId = \"\".concat(func, \"_\").concat(args[0]);\n\n    var handler = _this2.callBackend(func, args);\n\n    _this2.nodes[nodeId] = {\n      func: func,\n      args: args,\n      handler: handler\n    };\n    return function () {\n      var _this2$nodes$nodeId;\n\n      var r = (_this2$nodes$nodeId = _this2.nodes[nodeId]).handler.apply(_this2$nodes$nodeId, arguments);\n\n      delete _this2.nodes[nodeId];\n      return r;\n    };\n  };\n\n  var options = (0, _objectAssign.default)({\n    backends: []\n  }, sourceOptions || {});\n\n  if (options.backends.length < 1) {\n    throw new Error(\"You must specify at least one Backend, if you are coming from 2.x.x (or don't understand this error)\\n        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-2xx\");\n  }\n\n  this.current = 0;\n  this.backends = [];\n  options.backends.forEach(function (backend) {\n    if (!backend.backend) {\n      throw new Error(\"You must specify a 'backend' property in your Backend entry: \".concat(backend));\n    }\n\n    var transition = backend.transition;\n\n    if (transition && !transition._isMBTransition) {\n      throw new Error(\"You must specify a valid 'transition' property (either undefined or the return of 'createTransition') in your Backend entry: \".concat(backend));\n    }\n\n    _this2.backends.push({\n      instance: new backend.backend(manager, context, backend.options),\n      preview: backend.preview || false,\n      transition: transition,\n      skipDispatchOnTransition: Boolean(backend.skipDispatchOnTransition)\n    });\n  });\n  this.nodes = {};\n} // DnD Backend API\n;\n\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}